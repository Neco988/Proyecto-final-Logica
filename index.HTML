<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pac-Man Game</title>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #111;
        }
        canvas {
            border: 2px solid #fff;
        }
    </style>
</head>
<body>
    <div id="game">
        <canvas id="pacman" width="500" height="500"></canvas>
        <button id="restartButton" style="display: none;">Reiniciar</button>
        <div id="score">Puntuación: <span id="scoreValue">0</span></div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('pacman');
            const context = canvas.getContext('2d');
            const restartButton = document.getElementById('restartButton');
            const scoreValue = document.getElementById('scoreValue');

            let pacMan, ghost, coins, obstacles, walls, score, gameOver;

            function initializeGame() {
                pacMan = {
                    x: 50,
                    y: 50,
                    size: 20,
                    speed: 2,  // Velocidad de Pac-Man
                    direction: 0  // Dirección inicial (0: derecha, 1: abajo, 2: izquierda, 3: arriba)
                };

                ghost = {
                    x: 400,
                    y: 400,
                    size: 20,
                    speed: 1.5  // Velocidad del fantasma
                };

                coins = generateRandomCoins(10); // Generar 10 monedas al azar

                obstacles = [
                    {x: 100, y: 100, width: 50, height: 50},
                    {x: 200, y: 150, width: 100, height: 20},
                    {x: 300, y: 300, width: 50, height: 100}
                ];

                walls = [
                    {x: 0, y: 0, width: canvas.width, height: 20},  // Superior
                    {x: 0, y: canvas.height - 20, width: canvas.width, height: 20},  // Inferior
                    {x: 0, y: 0, width: 20, height: canvas.height},  // Izquierda
                    {x: canvas.width - 20, y: 0, width: 20, height: canvas.height}  // Derecha
                ];

                score = 0;
                gameOver = false;
                restartButton.style.display = 'none';
                gameLoop();
            }

            function generateRandomCoins(count) {
                const randomCoins = [];
                for (let i = 0; i < count; i++) {
                    const x = Math.random() * (canvas.width - 20) + 10; // Posición x aleatoria dentro del canvas
                    const y = Math.random() * (canvas.height - 20) + 10; // Posición y aleatoria dentro del canvas
                    randomCoins.push({ x, y });
                }
                return randomCoins;
            }

            function drawBackground() {
                context.fillStyle = '#000'; // Fondo del canvas
                context.fillRect(0, 0, canvas.width, canvas.height);
            }

            function drawObstacles() {
                context.fillStyle = '#00f'; // Color de los obstáculos
                obstacles.forEach(obstacle => {
                    context.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                });
            }

            function drawWalls() {
                context.fillStyle = '#0f0'; // Color de las paredes
                walls.forEach(wall => {
                    context.fillRect(wall.x, wall.y, wall.width, wall.height);
                });
            }

            function drawPacMan() {
                context.beginPath();
                let startAngle, endAngle;
                switch (pacMan.direction) {
                    case 0: // Derecha
                        startAngle = 0.2 * Math.PI;
                        endAngle = 1.8 * Math.PI;
                        break;
                    case 1: // Abajo
                        startAngle = 0.7 * Math.PI;
                        endAngle = 2.3 * Math.PI;
                        break;
                    case 2: // Izquierda
                        startAngle = 1.2 * Math.PI;
                        endAngle = 2.8 * Math.PI;
                        break;
                    case 3: // Arriba
                        startAngle = 1.7 * Math.PI;
                        endAngle = 0.3 * Math.PI;
                        break;
                }
                context.arc(pacMan.x, pacMan.y, pacMan.size, startAngle, endAngle);
                context.lineTo(pacMan.x, pacMan.y);
                context.fillStyle = 'yellow';
                context.fill();
                context.closePath();
            }

            function drawGhost() {
                context.beginPath();
                context.arc(ghost.x, ghost.y, ghost.size, 0, 2 * Math.PI);
                context.fillStyle = 'red';
                context.fill();
                context.closePath();
            }

            function drawCoins() {
                context.fillStyle = '#ff0'; // Color de las monedas
                coins.forEach(coin => {
                    context.beginPath();
                    context.arc(coin.x, coin.y, 5, 0, 2 * Math.PI);
                    context.fill();
                    context.closePath();
                });
            }

            function drawGameOver() {
                context.font = "40px Arial";
                context.fillStyle = "red";
                context.textAlign = "center";
                context.fillText("Game Over", canvas.width / 2, canvas.height / 2);
                restartButton.style.display = 'block';
            }

            function drawScore() {
                scoreValue.textContent = score;
            }

            function draw() {
                drawBackground();
                drawObstacles();
                drawWalls();
                drawPacMan();
                drawGhost();
                drawCoins();
                drawScore();
                if (gameOver) {
                    drawGameOver();
                }
            }

            function checkCollision(x, y, size, elements) {
                return elements.some(element => {
                    return x + size > element.x &&
                           x - size < element.x + element.width &&
                           y + size > element.y &&
                           y - size < element.y + element.height;
                });
            }

            function collectCoin() {
                coins.forEach((coin, index) => {
                    if (Math.abs(pacMan.x - coin.x) < pacMan.size && Math.abs(pacMan.y - coin.y) < pacMan.size) {
                        coins.splice(index, 1); // Elimina la moneda del array
                        score++; // Incrementa el puntaje
                    }
                });
            }

            function updatePacMan() {
                if (gameOver) return;

                let newX = pacMan.x;
                let newY = pacMan.y;

                switch(pacMan.direction) {
                    case 0: // Derecha
                        newX += pacMan.speed;
                        break;
                    case 1: // Abajo
                        newY += pacMan.speed;
                        break;
                    case 2: // Izquierda
                        newX -= pacMan.speed;
                        break;
                    case 3: // Arriba
                        newY -= pacMan.speed;
                        break;
                }

                if (newX - pacMan.size > 0 &&
                    newX + pacMan.size < canvas.width &&
                    newY - pacMan.size > 0 &&
                    newY + pacMan.size < canvas.height &&
                    !checkCollision(newX, newY, pacMan.size, obstacles) &&
                    !checkCollision(newX, newY, pacMan.size, walls)) {
                    pacMan.x = newX;
                    pacMan.y = newY;
                    collectCoin();
                } else if (checkCollision(newX, newY, pacMan.size, obstacles)) {
                    gameOver = true;  // Marca el juego como terminado si hay una colisión con obstáculos
                }

                draw();
            }

            function updateGhost() {
                if (gameOver) return;

                let dx = pacMan.x - ghost.x;
                let dy = pacMan.y - ghost.y;
                let distance = Math.sqrt(dx * dx + dy * dy);

                if (distance > 0) {
                    ghost.x += (dx / distance) * ghost.speed;
                    ghost.y += (dy / distance) * ghost.speed;
                }

                if (checkCollision(ghost.x, ghost.y, ghost.size, [{x: pacMan.x, y: pacMan.y, width: pacMan.size * 2, height: pacMan.size * 2}])) {
                    gameOver = true;  // Marca el juego como terminado si el fantasma atrapa a Pac-Man
                }

                draw();
            }

            function changeDirection(event) {
                switch(event.key) {
                    case 'ArrowUp':
                        pacMan.direction = 3;
                        break;
                    case 'ArrowDown':
                        pacMan.direction = 1;
                        break;
                    case 'ArrowLeft':
                        pacMan.direction = 2;
                        break;
                    case 'ArrowRight':
                        pacMan.direction = 0;
                        break;
                }
            }

            function gameLoop() {
                if (!gameOver) {
                    updatePacMan();
                    updateGhost();
                    requestAnimationFrame(gameLoop);
                }
            }

            document.addEventListener('keydown', changeDirection);
            restartButton.addEventListener('click', initializeGame);

            initializeGame();  // Inicializa el juego al cargar la página
        });
    </script>
</body>
</html>

